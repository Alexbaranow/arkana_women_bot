import { useState, useEffect } from "react";
import TarotShuffleLoader from "../components/TarotShuffleLoader";
import { useCardDayRequest } from "../context/CardDayRequestContext";
import { ScreenId } from "../constants/screens";
import { isUserRegistered } from "./Onboarding";
import { getInitData } from "../utils/telegram";
import { getApiUrl } from "../config/api";

const SPREADS = [
  {
    id: "card-day",
    title: "–ö–∞—Ä—Ç–∞ –¥–Ω—è",
    shortDesc: "–û–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ‚Äî —Å–æ–≤–µ—Ç –∏–ª–∏ —Ç–µ–º–∞ –¥–Ω—è",
    icon: "üÉè",
    price: null,
    description:
      "–û–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: —ç–Ω–µ—Ä–≥–∏—è –¥–Ω—è, —Å–æ–≤–µ—Ç –∏–ª–∏ —Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ—è –∏ —è—Å–Ω–æ—Å—Ç–∏ ‚Äî —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å –¥–µ–Ω—å –∏ –∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Å–∏–ª—ã. –ì–æ—Ç–æ–≤–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.",
    whatIncluded: [
      "–û–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –¢–∞—Ä–æ –Ω–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å",
      "–û–ø–∏—Å–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –¥–Ω—è –∏ –ª–∏—á–Ω—ã–π —Å–æ–≤–µ—Ç",
      "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è",
    ],
  },
  {
    id: "card-3days",
    title: "–ö–∞—Ä—Ç–∞ –¥–Ω—è –Ω–∞ 3 –¥–Ω—è",
    shortDesc: "–ö–∞–∂–¥—É—é –∫–∞—Ä—Ç—É –ª–∏—á–Ω–æ —Å—á–∏—Ç–∞–µ—Ç —Ç–∞—Ä–æ–ª–æ–≥ ‚Äî –Ω–µ –ò–ò",
    icon: "ü™ô",
    price: 99,
    description:
      "–ö–∞—Ä—Ç–∞ –¥–Ω—è –Ω–∞ 3 –¥–Ω—è ‚Äî —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∫–æ–º–ø–∞—Å –Ω–∞ –Ω–µ–¥–µ–ª—é üîÆ –í –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ –¥–Ω—è —Ä–∞—Å–∫–ª–∞–¥ —Å—á–∏—Ç–∞–µ—Ç –ò–ò; –∑–¥–µ—Å—å –∫–∞–∂–¥—É—é –∏–∑ —Ç—Ä—ë—Ö –∫–∞—Ä—Ç –ª–∏—á–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–∞—Ä–æ–ª–æ–≥. –ü–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è) + –∫–∞—Ä—Ç–∞ –¢–∞—Ä–æ: —Ç–æ—á–∫–∏ —Ä–æ—Å—Ç–∞ –∏ —á—Ç–æ —É—Å–∏–ª–∏—Ç—å üåü, —á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å ‚ö†Ô∏è, –≥–¥–µ –∂–¥—ë—Ç —É–¥–∞—á–∞ üçÄ. –†–∞—Å–∫–ª–∞–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—É—Ç—Ä–æ, –¥–µ–Ω—å, –≤–µ—á–µ—Ä –∏–ª–∏ –Ω–æ—á—å –ø–æ –ú–°–ö). –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.",
    whatIncluded: [
      "–¢—Ä–∏ –∫–∞—Ä—Ç—ã (–¥–µ–Ω—å 1, 2, 3) ‚Äî –∫–∞–∂–¥—É—é –ª–∏—á–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–∞—Ä–æ–ª–æ–≥, –Ω–µ –ò–ò",
      "–ü–æ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–µ: –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ —É—Å–∏–ª–∏—Ç—å, —á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å, –≥–¥–µ —É–¥–∞—á–∞",
      "–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏: —É—Ç—Ä–æ (8‚Äì10), –¥–µ–Ω—å (12‚Äì14), –≤–µ—á–µ—Ä (18‚Äì20) –∏–ª–∏ –Ω–æ—á—å (22‚Äì00) –ú–°–ö",
    ],
  },
  {
    id: "three-cards",
    title: "–¢—Ä–∏ –∫–∞—Ä—Ç—ã",
    shortDesc: "–ü—Ä–æ—à–ª–æ–µ ‚Äî –Ω–∞—Å—Ç–æ—è—â–µ–µ ‚Äî –±—É–¥—É—â–µ–µ",
    icon: "üìú",
    price: 290,
    description:
      "–£–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É: –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∞ —Å–∏—Ç—É–∞—Ü–∏—è, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å –∏ –∫—É–¥–∞ –≤–µ–¥—ë—Ç. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–∞—Å–∫–ª–∞–¥ –∏–∑ —Ç—Ä—ë—Ö –∫–∞—Ä—Ç –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∞—Ä–æ–ª–æ–≥ (–Ω–µ –ò–ò): –ø—Ä–æ—à–ª–æ–µ, –Ω–∞—Å—Ç–æ—è—â–µ–µ, –±—É–¥—É—â–µ–µ ‚Äî —Å–≤—è–∑–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, —Å–∫—Ä—ã—Ç—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç —Å —Ç–∞–π–º–∏–Ω–≥–æ–º. –ì–æ—Ç–æ–≤–æ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.",
    whatIncluded: [
      "–ü—Ä–æ—à–ª–æ–µ ‚Äî –∫–∞–∫ —Å–∏—Ç—É–∞—Ü–∏—è —Ä–∞–∑–≤–∏–≤–∞–ª–∞—Å—å, –∫–æ—Ä–Ω–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç",
      "–ù–∞—Å—Ç–æ—è—â–µ–µ ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å, –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã",
      "–ë—É–¥—É—â–µ–µ ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã–π –∏—Å—Ö–æ–¥ –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º –≤–µ–∫—Ç–æ—Ä–µ",
      "–°–≤—è–∑–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏ —Å–æ–≤–µ—Ç —Å —Ç–∞–π–º–∏–Ω–≥–æ–º",
    ],
  },
  // –ü–ª–∞—Ç–Ω—ã–µ —Ä–∞—Å–∫–ª–∞–¥—ã (–º–∞—Ä–∫–µ—Ç–∏–Ω–≥: —Ü–µ–Ω–Ω–æ—Å—Ç—å ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –¥–æ–≤–µ—Ä–∏–µ, –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞)
  {
    id: "heart-present",
    title: "–°–µ—Ä–¥—Ü–µ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º",
    shortDesc: "–õ—é–±–æ–≤—å: —Ç–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –±–ª–æ–∫–∏ –∏ —à–∞–≥–∏ –≤–ø–µ—Ä—ë–¥",
    icon: "‚ù§Ô∏è",
    price: 690,
    description:
      "–ü–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ª—é–±–æ–≤—å—é —Å–µ–π—á–∞—Å –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ. –†–∞—Å–∫–ª–∞–¥ –∏–∑ 5 –∫–∞—Ä—Ç –ø–æ —Ç–≤–æ–µ–π –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∞—Ä–æ–ª–æ–≥ (–Ω–µ –ò–ò): –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å —Å–µ—Ä–¥—Ü–∞, —á—Ç–æ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—à—å, –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1‚Äì3 –º–µ—Å—è—Ü–∞, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—é –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç —Å —Ç–∞–π–º–∏–Ω–≥–æ–º. –ì–æ—Ç–æ–≤–æ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞. –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å.",
    whatIncluded: [
      "–¢–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ª—é–±–≤–∏ —Å–µ–π—á–∞—Å ‚Äî –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º",
      "–ß—Ç–æ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—à—å —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏ ‚Äî —Ç–∏–ø –ª—é–¥–µ–π –∏ —Å–∏—Ç—É–∞—Ü–∏–π –≤ —Ç–≤–æ–µ–π —Å—Ñ–µ—Ä–µ",
      "–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1‚Äì3 –º–µ—Å—è—Ü–∞ ‚Äî –Ω–æ–≤–∞—è –ª–∏–Ω–∏—è –∏–ª–∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ–∫—É—â–µ–≥–æ",
      "–ß—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—é ‚Äî —Å—Ç—Ä–∞—Ö–∏, –æ–±–∏–¥—ã, –∫–∞—Ä–º–∞, –≤–Ω–µ—à–Ω–∏–µ –ø–æ–º–µ—Ö–∏",
      "–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç –æ—Ç –∫–∞—Ä—Ç + —Ç–∞–π–º–∏–Ω–≥ ‚Äî —à–∞–≥–∏ —Å–µ–π—á–∞—Å –∏ –∫–æ–≥–¥–∞ –∂–¥–∞—Ç—å —Å–¥–≤–∏–≥–∞",
      "–î–æ–ø. –≤–æ–ø—Ä–æ—Å –ø–æ –ª—é–±–≤–∏ ‚Äî +290 ‚ÇΩ",
    ],
  },
  {
    id: "golden-flow",
    title: "–ó–æ–ª–æ—Ç–æ–π –ø–æ—Ç–æ–∫",
    shortDesc: "–§–∏–Ω–∞–Ω—Å—ã: –∫–∞–Ω–∞–ª—ã –∏–∑–æ–±–∏–ª–∏—è, –±–ª–æ–∫–∏ –∏ –ª—É—á—à–∏–π –ø—É—Ç—å",
    icon: "üí∞",
    price: 690,
    description:
      "–£–∑–Ω–∞—Ç—å, –æ—Ç–∫—Ä—ã—Ç—ã –ª–∏ –∫–∞–Ω–∞–ª—ã –∏–∑–æ–±–∏–ª–∏—è –∏ –∫—É–¥–∞ –¥–≤–∏–≥–∞—Ç—å—Å—è. 5 –∫–∞—Ä—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–æ–ª–æ–≥–∞ –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è: —Ç–≤–æ—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è, –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞ –≤ –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü, –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, –ª—É—á—à–∏–π –ø—É—Ç—å –∫ –¥–µ–Ω—å–≥–∞–º –∏ —Å–æ–≤–µ—Ç —Å —Ç–∞–π–º–∏–Ω–≥–æ–º (7‚Äì30 –¥–Ω–µ–π). –ì–æ—Ç–æ–≤–æ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.",
    whatIncluded: [
      "–¢–≤–æ—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è —Å–µ–π—á–∞—Å ‚Äî –±–ª–æ–∫–∏ –≤ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–∏ –∏ —É–±–µ–∂–¥–µ–Ω–∏—è—Ö",
      "–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞ –≤ –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü ‚Äî —Ä–∞–±–æ—Ç–∞, –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–∏",
      "–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –¥–ª—è —Ä–æ—Å—Ç–∞ ‚Äî —á—Ç–æ —Ç–æ—Ä–º–æ–∑–∏—Ç –ø–æ—Ç–æ–∫",
      "–õ—É—á—à–∏–π –ø—É—Ç—å –∫ –¥–µ–Ω—å–≥–∞–º ‚Äî —Å—Ñ–µ—Ä–∞ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–∞–∏–±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω–æ–µ —Å–µ–π—á–∞—Å",
      "–°–æ–≤–µ—Ç –∫–∞—Ä—Ç + —Ç–∞–π–º–∏–Ω–≥ ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å/–Ω–µ –¥–µ–ª–∞—Ç—å –∏ –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—Ç—å",
      "–î–æ–ø. –≤–æ–ø—Ä–æ—Å –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º ‚Äî +290 ‚ÇΩ",
    ],
  },
  {
    id: "body-energy",
    title: "–≠–Ω–µ—Ä–≥–∏—è —Ç–µ–ª–∞",
    shortDesc: "–ñ–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞, —á—Ç–æ –∏—Å—Ç–æ—â–∞–µ—Ç –∏ —á—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç",
    icon: "üíö",
    price: 690,
    description:
      "–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Å—Ä–µ–∑ –±–µ–∑ –¥–∏–∞–≥–Ω–æ–∑–æ–≤: —É—Ä–æ–≤–µ–Ω—å —Å–∏–ª, —á—Ç–æ –∏—Å—Ç–æ—â–∞–µ—Ç, —á—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç, –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–µ –∑–æ–Ω—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º. –¢–æ–ª—å–∫–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ ‚Äî –Ω–µ –∑–∞–º–µ–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω–µ. 5 –∫–∞—Ä—Ç, —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∞—Ä–æ–ª–æ–≥, –≥–æ—Ç–æ–≤–æ –∑–∞ 2 —á–∞—Å–∞. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ.",
    whatIncluded: [
      "–¢–≤–æ—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞ —Å–µ–π—á–∞—Å ‚Äî –∑–∞–∑–µ–º–ª—ë–Ω–Ω–æ—Å—Ç—å, –≤—ã–≥–æ—Ä–∞–Ω–∏–µ, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞",
      "–ß—Ç–æ –∏—Å—Ç–æ—â–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º ‚Äî —ç–º–æ—Ü–∏–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞, –ø—Ä–∏–≤—ã—á–∫–∏",
      "–ß—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–ª—ã ‚Äî –ø—Ä–∞–∫—Ç–∏–∫–∏, –ª—é–¥–∏, –º–µ—Å—Ç–∞, –¥–µ–π—Å—Ç–≤–∏—è",
      "–ù–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –∑–æ–Ω—ã ‚Äî —á—Ç–æ —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ —Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–ª–µ",
      "–°–æ–≤–µ—Ç—ã –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏ —Ç–µ–ª–∞ –∏ –¥—É—à–∏ ‚Äî —Ä–µ–∂–∏–º, –ø–∏—Ç–∞–Ω–∏–µ, –ø—Ä–∞–∫—Ç–∏–∫–∏ + —Ç–∞–π–º–∏–Ω–≥",
      "–î–æ–ø. –≤–æ–ø—Ä–æ—Å –ø–æ –∑–¥–æ—Ä–æ–≤—å—é/—ç–Ω–µ—Ä–≥–∏–∏ ‚Äî +290 ‚ÇΩ",
    ],
  },
];

export default function AllSpreads({ onBack, onNavigate }) {
  const {
    isRequesting: isCardDayRequesting,
    hasCardOfTheDay,
    setHasCardOfTheDay,
  } = useCardDayRequest();
  const [expandedId, setExpandedId] = useState(null);

  useEffect(() => {
    const base = getApiUrl() || "";
    fetch(`${base}/api/card-of-the-day/get`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ initData: getInitData() }),
    })
      .then((res) => res.json())
      .then((data) => setHasCardOfTheDay(!!(data.ok && data.card?.text)))
      .catch(() => setHasCardOfTheDay(false));
  }, [setHasCardOfTheDay]);

  const toggle = (id) => {
    setExpandedId((prev) => (prev === id ? null : id));
  };

  const handleOrder = (e, spread) => {
    e.stopPropagation();
    const productId = spread.id;
    if (!productId) return;
    // –ö–∞—Ä—Ç–∞ –¥–Ω—è ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ; –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –µ—Å–ª–∏ —É–∂–µ –∏–¥—ë—Ç —Ä–∞—Å—á—ë—Ç
    if (productId === "card-day") {
      if (isCardDayRequesting) return;
      if (isUserRegistered()) {
        onNavigate(ScreenId.CARD_DAY_REQUEST);
      } else {
        onNavigate(ScreenId.ONBOARDING, { next: productId });
      }
      return;
    }
    if (isUserRegistered()) {
      onNavigate(ScreenId.CHECKOUT, { productId });
    } else {
      onNavigate(ScreenId.ONBOARDING, { next: productId });
    }
  };

  return (
    <div className="screen">
      <header
        className="header header-compact"
        data-aos="fade-down"
      >
        <button
          className="btn-back"
          onClick={onBack}
        >
          ‚Üê
        </button>
        <h1>–í—Å–µ —Ä–∞—Å–∫–ª–∞–¥—ã</h1>
      </header>

      <main>
        <p
          className="subtitle"
          style={{ marginBottom: "8px" }}
          data-aos="fade-up"
          data-aos-delay="50"
        >
          –í—ã–±–µ—Ä–∏ —Ä–∞—Å–∫–ª–∞–¥ ‚Äî –≤—Å–µ —Ä–∞—Å–∫–ª–∞–¥—ã –¥–µ–ª–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–∞—Ä–æ–ª–æ–≥
        </p>
        <p
          className="subtitle"
          style={{
            marginBottom: "20px",
            fontSize: "13px",
            color: "var(--color-text-muted)",
          }}
          data-aos="fade-up"
          data-aos-delay="80"
        >
          üîÆ –ù–µ –±–æ—Ç: –∂–∏–≤–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–∞—Ä—Ç
        </p>

        <div className="spread-list">
          {SPREADS.map((s, idx) => {
            const isExpanded = expandedId === s.id;
            return (
              <div
                key={s.id}
                className={`spread-card ${s.price ? "spread-card-paid" : ""} ${
                  isExpanded ? "spread-card-expanded" : ""
                }`}
              >
                <button
                  type="button"
                  className="spread-card-head"
                  onClick={() => toggle(s.id)}
                  aria-expanded={isExpanded}
                >
                  <span className="menu-icon">{s.icon}</span>
                  <div className="menu-text spread-card-text">
                    <span className="menu-title">{s.title}</span>
                    <span className="menu-desc">{s.shortDesc}</span>
                  </div>
                  {s.price != null ? (
                    <span className="menu-price spread-card-price">
                      {s.price} ‚ÇΩ
                    </span>
                  ) : (
                    <span
                      className="menu-price spread-card-price"
                      style={{ color: "var(--color-primary)" }}
                    >
                      –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
                    </span>
                  )}
                  <span
                    className="spread-card-chevron"
                    aria-hidden
                  >
                    {isExpanded ? "‚ñ≤" : "‚ñº"}
                  </span>
                </button>

                {isExpanded && (
                  <div className="spread-card-body">
                    <p className="spread-card-description">{s.description}</p>
                    <p className="spread-card-label">–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç:</p>
                    <ul className="spread-card-list">
                      {s.whatIncluded.map((item, i) => (
                        <li key={i}>{item}</li>
                      ))}
                    </ul>
                    {s.price != null && (
                      <>
                        <p className="spread-card-total">
                          –°—Ç–æ–∏–º–æ—Å—Ç—å: <strong>{s.price} ‚ÇΩ</strong>
                        </p>
                        <p className="spread-card-trust">
                          ‚è∞ –ì–æ—Ç–æ–≤–æ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ ¬∑ –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å üîí
                        </p>
                      </>
                    )}
                    {s.id === "card-day" && isCardDayRequesting ? (
                      <div
                        className="btn btn-primary spread-card-btn spread-card-btn-requesting"
                        role="status"
                        aria-busy="true"
                      >
                        <span>–ò–¥—ë—Ç —Ä–∞—Å—á—ë—Ç</span>
                        <TarotShuffleLoader size={24} />
                      </div>
                    ) : (
                      <button
                        type="button"
                        className="btn btn-primary spread-card-btn"
                        onClick={(e) => handleOrder(e, s)}
                      >
                        {s.id === "card-day"
                          ? hasCardOfTheDay
                            ? "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ä—Ç—É"
                            : "–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç—É –¥–Ω—è"
                          : "–ó–∞–∫–∞–∑–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥"}
                      </button>
                    )}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </main>
    </div>
  );
}
